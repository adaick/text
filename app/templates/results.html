{% extends 'layout.html' %}
{% block title %}Simulation Results{% endblock %}
{% block content %}

<div class="result-actions">
    <a href="{{ url_for('routes.history') if current_user.is_authenticated else '#' }}" class="btn" onclick="{{ 'return confirmLogin()' if not current_user.is_authenticated else '' }}">History</a>
    <a href="#" class="btn" onclick="downloadReport()">Download Report</a>
    <a href="{{ url_for('routes.form') }}" class="btn">Adjust Portfolio</a>
    <a href="{{ url_for('routes.home') }}" class="btn">Back to Home</a>
    <a href="{{ url_for('routes.more_charts') }}" class="btn">More Charts</a>
</div>

<h2 class="section-title">Portfolio Simulation Summary</h2>

{% if current_user.is_authenticated %}
<p class="welcome-msg">Hello {{ current_user.username }} üëã</p>
{% endif %}

<div class="metrics">
    <div class="card"><h3>Strategy</h3><p>{{ strategy.replace('-', ' ').title() }}</p></div>
    <div class="card"><h3>Expected Return</h3><p>{{ expected_return }}%</p></div>
    <div class="card"><h3>Volatility Cap</h3><p>{{ volatility_cap }}%</p></div>
    <div class="card"><h3>Sharpe Ratio</h3><p>{{ sharpe_ratio }}</p></div>
</div>
<div class="tags">
    <span class="tag">‚úîÔ∏è Eco-Friendly</span>
    <span class="tag">‚úîÔ∏è Risk Managed</span>
    <span class="tag">‚úîÔ∏è Low Volatility</span>
</div>

<h3 class="subsection">üìä Performance Overview</h3>
<img src="{{ url_for('static', filename='charts/mu_sigma_diagram.jpg') }}" class="chart-img" alt="mu-sigma-diagram">

<h3 class="subsection">üìà Strategy Comparison</h3>
<img src="{{ url_for('static', filename='charts/cum_log_returns_all_place_legends.jpg') }}" class="chart-img" alt="cumulative returns">

<h3 class="subsection">üìâ Allocation Timeline</h3>
<img src="{{ url_for('static', filename='charts/weight_plot_with_smoothing.jpg') }}" class="chart-img" alt="weight plot">

<div id="download-toast" class="toast" style="display:none;">Report downloaded successfully!</div>

<script>
function downloadReport() {
    const element = document.body.cloneNode(true);
    const blob = new Blob([element.innerHTML], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'Green_Robo_Report.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    document.getElementById('download-toast').style.display = 'block';
    setTimeout(() => document.getElementById('download-toast').style.display = 'none', 2000);
}
function confirmLogin() {
    alert('Please log in to access your simulation history.');
    return false;
}
</script>

<style>
.result-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}
.btn {
    background-color: #00c853;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    transition: background-color 0.3s;
}
.btn:hover { background-color: #00b24a; }

.section-title {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: white;
}
.metrics {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}
.card {
    background: #1e1e1e;
    border-left: 4px solid #00c853;
    padding: 1rem;
    border-radius: 8px;
    flex: 0 0 160px;
    color: white;
}
.tags {
    margin-bottom: 2rem;
}
.tag {
    display: inline-block;
    background: #2e2e2e;
    color: #00e676;
    padding: 0.3rem 0.8rem;
    border-radius: 999px;
    font-size: 0.85rem;
    margin-right: 0.5rem;
}
.subsection {
    margin-top: 2.5rem;
    font-size: 1.3rem;
    border-bottom: 1px solid #00c853;
    padding-bottom: 0.3rem;
    color: white;
}
.chart-img {
    width: 100%;
    max-width: 900px;
    margin-top: 1rem;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,200,83,0.2);
}
.toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #333;
    color: #00e676;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    box-shadow: 0 0 10px rgba(0,200,83,0.4);
}
</style>
{% endblock %}
